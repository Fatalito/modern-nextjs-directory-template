name: Bootstrap â€” Checkout, (optional) Node.js & Install Dependencies
description: >
  Checks out the repository, optionally sets up Node.js from .nvmrc,
  restores/saves the node_modules cache, and runs npm ci when the cache is cold.
  Set install-node to 'false' for jobs running inside the Playwright Docker
  container (mcr.microsoft.com/playwright), which already ships with Node 24.

inputs:
  checkout-ref:
    description: Git ref to checkout. Defaults to the event's triggering ref.
    required: false
    default: ''
  install-node:
    description: >
      Run actions/setup-node. Set to 'false' when the job container already
      provides the correct Node.js version (e.g. the Playwright Docker image).
    required: false
    default: 'true'

runs:
  using: composite
  steps:
    - name: Checkout
      uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
      with:
        ref: ${{ inputs.checkout-ref }}

    - name: Set up Node.js
      if: inputs.install-node == 'true'
      uses: actions/setup-node@6044e13b5dc448c55e2357c09f80417699197238 # v6.2.0
      with:
        node-version-file: '.nvmrc'
        cache: 'npm'

    - name: Restore/Save node_modules
      id: node-modules-cache
      uses: actions/cache@cdf6c1fa76f9f475f3d7449005a359c84ca0f306 # v5.0.3
      with:
        path: node_modules
        key: ${{ runner.os }}-node-modules-${{ hashFiles('package-lock.json') }}

    - name: Install dependencies
      if: steps.node-modules-cache.outputs.cache-hit != 'true'
      shell: bash
      run: npm ci --ignore-scripts --prefer-offline --no-audit
