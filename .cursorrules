# AI Instructions & Project Rules

You are an expert AI assistant working on a scalable **Next.js** project.
These rules must be followed in every response, code generation, and refactoring task.

## ⚠️ Critical Checklist (Most Overlooked)

Before generating code, verify:
1. **Write test first**: Write failing test → minimal pass → refactor green
2. **FSD Public APIs**: Import only via public API; no internal paths; UI uses public API
3. **Be DRY**: Refactor repeated logic; keep responses concise
4. **Type Reuse**: Export types from schemas (no duplicate type definitions)
5. **Single Responsibility**: Each module/factory does one thing
6. **Schema Compliance**: Embedded schemas match constraints; mock/seed data uses valid UUIDs
7. **Biome Compliance**: Format and organize imports before presenting code

## 1. Project Stack & Architecture

- **Framework:** Next.js 16+ (App Router, Server Components).
- **Runtime:** Node.js v24 (verify via `.nvmrc`).
- **Language:** TypeScript (Strict mode).
- **Styling:** Tailwind CSS v4 & Shadcn UI.
- **Linting & Formatting:** Biome (Use `biome check` and `biome format`).
- **Testing:**
  - **Unit:** Vitest (React Testing Library).
  - **E2E/Integration:** Playwright.
- **Architecture:**
  - **Structure:** Feature-Sliced Design (FSD).
    - `src/shared`: Reusable low-level code (ui kit, libs, api).
    - `src/entities`: Business entities (e.g., user, post).
    - `src/features`: User interactions (e.g., login, like-post).
    - `src/widgets`: Compositional blocks (e.g., header, sidebar).
    - `src/views`: Composition of widgets for specific routes.
    - `src/app`: App-wide settings, styles, and routing.
  - **Routing:** Multi-Zones strategy with Route Groups for isolation: `(listing)`, `(dashboard)`, `(blog)`, `(admin)`.

## 2. Coding Style: Strict Functional Programming

- **Pure Functions:** Prefer pure functions. Side effects must be isolated.
- **Function Declarations for UI**: `export function ComponentName() { ... }` for React components (better stack traces, automatic displayName).
- **Arrow Functions for Logic**: `const logicName = () => { ... }` for utilities, event handlers, hooks, internal logic.
- **NO Classes**: Forbidden. Use Composition and Functional Mixins instead.
- **Factories over Classes**:
  - Use **Factory Functions** (e.g., `createService`) to generate stateful/complex objects.
  - Use **Closures** within factories to maintain private state.
  - Always define explicit return types for the "Contract."

### Example: Factory Pattern
```typescript
type CounterService = {
  increment: () => void;
  getCount: () => number;
};

const createCounterService = (initialValue: number = 0): CounterService => {
  let count = initialValue; // Private state via closure

  return {
    increment: () => { count += 1; },
    getCount: () => count,
  };
};
```

## 3. SOLID Principles (Functional Adaptation)

- **OCP:** Extend via composition, not modification.
- **LSP:** Interfaces must be interchangeably implemented.
- **ISP:** Return small, focused interfaces.
- **DIP:** **Inject dependencies** as arguments. **Never** instantiate inside factory.

```typescript
// ❌ BAD - Internal coupling
const createUserService = () => {
  const db = createDatabase();
};

// ✅ GOOD - Dependency injection
const createUserService = (db: Database) => {
  // ...
};
```

## 4. Naming Conventions

### Factory Functions
- **`create...`**: Returns interface caller uses to control behavior. Example: `createService()` → `{ start, stop }`
- **`start...`**: Fire-and-forget background process. Example: `startHealthServer()`

### Files & Identifiers
- **kebab-case**: Files (`user-profile.tsx`, `auth-service.ts`)
- **camelCase**: Functions, runtime constants
- **SCREAMING_SNAKE_CASE**: Compile-time patterns (regex, config literals)
- **PascalCase**: Types, Components, Zod Schemas

## 5. Development Workflow

- **Atomic Commits:** Small, focused on single feature/fix.

## 6. Code Quality

- **Naming Over Comments**: Use expressive names, extract magic values to constants, avoid numbered comments
- **Avoid Default Exports**: Only use when framework requires (Next.js `page.tsx`, `layout.tsx`)
- **Decouple Tests**: Use explicit test data, not shared config imports
- **License**: Apache 2.0

## 7. React Patterns

- **No React Import for JSX**: Automatic transform enabled
- **React Compiler Enabled**: Don't use `useMemo`/`useCallback`/`React.memo` unless external library requires stable identity
- **Server Components Default**: Use `'use client'` only for hooks/DOM events
- **Typography**: `text-balance` for headings (h1-h3), `text-pretty` for body text

### Component Structure
- **Named Function Exports**: `export function BusinessCard({ name }: Props) { ... }`
- **No forwardRef**: Use React 19's `ref` prop directly
- **Shadcn/UI**: Refactor to match Biome formatting

**Import Rules:**
- **Absolute (`@/`)**: Cross-boundary (different entities/layers/shared)
  - ✅ `import { Contact } from "@/entities/contact"`
  - ✅ `import { cn } from "@/shared/lib/utils"`
- **Relative**: Same-directory siblings within same layer
  - ✅ `import type { Contact } from "./schema"`
  - ❌ Never for cross-entity imports

### State & Data
- **URL State**: Prefer `searchParams` over global client state
- **Mutations**: Use Server Actions
- **i18n**: All user-facing strings via `next-intl`, hardcoded strings forbidden

## 8. FSD Public APIs (Gatekeeper Pattern)

**⚠️ Every FSD layer MUST export via `index.ts`**

### Entity Public API Must Export:
- Types and schemas from `./model/schema`
- Selectors from `./model/selectors` (if exist)
- Validation from `./model/validation` (if exist)
- UI components from `./ui/` (if exist)

### Additional FSD Rules:
- **Metadata**: Never hardcode in `layout.tsx`/`page.tsx` - pull from `@/shared/config`
- **Semantic HTML**: Clear hierarchy with `<header>`, `<main>`, `<footer>`

## 9. AI Behavior

- **Context Awareness**: Analyze tech stack intersections, identify conflicts proactively
- **Precision**: Use exact technical terms (`camelCase` not "camel case"), disambiguate overloaded terms
- **Code Consistency**: Adhere strictly to style guide including semicolons, spacing
- **Proactive Adaptation**: If pattern conflicts with config, propose safer adaptation for this environment

---

**Remember: Quality, Consistency, and Maintainability are paramount.**

